<!DOCTYPE html>
<html>

<head>
	<title>fractiform</title>
	<style>
	body {
		font-family: sans-serif;
		background-color: black;
		margin: 0;
		padding: 0;
		color: white;
		overflow: hidden;
	}
	
	
	:root {
		--ui-border: white;
		--ui-height: 2.5em;
	}
	
	#page {
		width: 100vw;
		height: 100vh;
		position: relative;
	}
	
	#canvas {
		position: absolute;
		left: 0;
		bottom: 0;
	}
	
	#ui-canvas {
		border: 2px solid var(--ui-border);
	}
	
	.error {
		color: red;
	}
	
	#error-dialog {
		border: 2px solid red;
		background-color: black;
	}
	dialog button {
		font-family: monospace;
	}
	button {
		border: 2px solid var(--ui-border);
		background-color: black;
		color: white;
	}
	button:hover, input:hover, input:active {
		background-color: #fff3;
	}
	button:active, button[data-selected="true"] {
		background-color: #fff6;
	}
	button:focus, input:focus {
		outline: 2px solid #0a0;
	}
	#ui {
		position: absolute;
		top: 0;
		left: 0;
		width: 20vw;
		height: 100vh;
		resize: horizontal;
		overflow: scroll;
		border-right: 2px solid white;
		padding: 0.2em;
	}
	input, button {
		vertical-align: middle;
		display: inline-block;
		margin: 0.3em 0 0.3em 0.3em;
		border: 2px solid var(--ui-border);
		background-color: transparent;
		color: white;
	}
	button {
		height: 2.0em;
	}
	input {
		height: 1.5em;
		font-size: inherit;
	}
	#ui input[type=color] {
		padding: 0;
	}
	.in input {
		width: 5em;
	}
	.out {
		font-weight: bold;
	}
	input[type=number] {
		/* disable increment/decrement buttons (firefox) */
		-moz-appearance: textfield;
	}
	input::-webkit-outer-spin-button, input::-webkit-inner-spin-button {
		/* disable increment/decrement buttons (webkit) */
		-webkit-appearance: none;
	}
	img.icon {
		height: 1.5em;
	}
	.widget {
		border: 2px solid white;
		border-radius: 5px;
		padding: 5px;
		margin: 0.5em;
		background: #111;
		position: relative;
	}
	.outs {
		position: absolute;
		bottom: 0.2em;
		right: 0.2em;
	}
	.widget-title {
		font-weight: bold;
		margin: 2px;
		display: block;
	}
	</style>
	<meta charset="utf-8">
	<meta content="width=device-width,initial-scale=1" name="viewport">
	<script id="main-vertex-shader" type="x-shader/x-vertex">
attribute vec2 v_pos;
varying vec2 uv;
void main() {
	uv = v_pos * 0.5 + 0.5;
	gl_Position = vec4(v_pos, 0.0, 1.0);
}
	</script>
	<script id="main-fragment-shader" type="x-shader/x-fragment">
#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D u_texture;
uniform float u_time;
varying vec2 uv;

void main() {
	vec2 u = pow(uv,vec2(1.2 + 0.4 * sin(u_time)));
	vec2 k =floor(3.0 * u); 
	int i = int(k.y * 3.0 + k.x);
	if (i == 4) discard;
	vec3 sample = texture2D(u_texture, mod(3.0*u, 1.0)).xyz;
	float h = mod(float(i) * 5.0, 8.0) / 8.0;
	sample = vec3(
		mix(sample.x, sample.z, h),
		mix(sample.y, sample.x, h),
		mix(sample.z, sample.y, h)
	);
	gl_FragColor = vec4(mix(sample, vec3(1.0,0.0,0.0), 0.2),1.0);
}
	</script>
	
	<script id="post-vertex-shader" type="x-shader/x-vertex">
attribute vec2 v_pos;
varying vec2 uv;
void main() {
	uv = v_pos * 0.5 + 0.5;
	gl_Position = vec4(v_pos, 0.0, 1.0);
}
	</script>
	<script id="post-fragment-shader" type="x-shader/x-fragment">
#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_texture;
varying vec2 uv;
void main() {
	gl_FragColor = texture2D(u_texture, uv);
}
	</script>
</head>

<body>
<script src="fractiform.js" type="text/javascript"></script>
<div id="page">
	<noscript>
		<p>
			This page requires JavaScript to function.<br>
			Try using a modern browser such as <em>Netscape Navigator</em>&reg;.
		</p>
	</noscript>
	<div id="ui">
		<div class="widget" data-func="mix">
			<div class="widget-title">Mix <input placeholder="name" class="name" type="text"></div>
			<div class="in"><input type="text" id="src1"> <label for="src1">src1</label></div>
			<div class="in"><input type="text" id="src2"> <label for="src2">src2</label></div>
			<div class="in"><input type="text" id="mix"> <label for="mix">mix</label></div>
			<div class="outs">
				<div class="out">out</div>
			</div>
		</div>
		<div class="widget" data-func="mix">
			<div class="widget-title">Mix <input placeholder="name" class="name" type="text"></div>
			<div class="in"><input type="text" id="asrc1"> <label for="asrc1">src1</label></div>
			<div class="in"><input type="text" id="asrc2"> <label for="asrc2">src2</label></div>
			<div class="in"><input type="text" id="amix"> <label for="amix">mix</label></div>
			<div class="outs">
				<div class="out">out</div>
			</div>
		</div>
		<div class="widget" data-func="output">
			<div class="widget-title">Output Color</div>
			<div class="in"><input type="text" id="out"> <label for="out">value</label></div>
		</div>
	</div>
	<canvas id="canvas">
		<p>
			Your browser doesn't support HTML5 &lt;canvas&gt;.<br>
			Try upgrading to the latest version of Microsoft Internet Explorer&reg;.
		</p>
	</canvas>
</div>

<dialog id="error-dialog">
  <pre id="error-message" class="error"></pre>
</dialog>

</body>
</html>
